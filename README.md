# X5 Recruitment Ranker Service

# 1. –û–±–∑–æ—Ä (Overview)

**Candidate Scoring Service** ‚Äî —ç—Ç–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏–∏. –°–µ—Ä–≤–∏—Å —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Å–∫–æ—Ä–∏–Ω–≥—É, –æ–±—ä–µ–¥–∏–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ ML –∏ –≥–ª—É–±–∏–Ω—É –∞–Ω–∞–ª–∏–∑–∞ –±–æ–ª—å—à–∏—Ö —è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π (LLM).

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
*   **–ì–∏–±—Ä–∏–¥–Ω—ã–π —Å–∫–æ—Ä–∏–Ω–≥:**
    *   üöÄ **Baseline (TF-IDF + Linear Regression):** –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (–≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ < 50ms). –û–±—É—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–∏—Å–∞ –Ω–∞ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
    *   üß† **LLM Analysis (OpenAI / GPT):** –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—é–º–µ —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π —Ä–µ—à–µ–Ω–∏—è (`reason`). –í—ã—è–≤–ª—è–µ—Ç —Å–∫—Ä—ã—Ç—ã–µ –Ω–∞–≤—ã–∫–∏ –∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è.
*   **Stateless –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –ù–µ —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –ª–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ.
*   **–ì–∏–±–∫–∏–π API:** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –±–∞—Ç—á–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.

***

# 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–°–µ—Ä–≤–∏—Å —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞–π–º–∞. –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

1.  **File Management Service (Orchestrator)** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –±–∞—Ç—á –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ (`POST /score_candidates`).
2.  **ML Scorer Service** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å:
    *   –í —Ä–µ–∂–∏–º–µ *Baseline*: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –º–æ–¥–µ–ª—å (In-memory).
    *   –í —Ä–µ–∂–∏–º–µ *LLM*: –¥–µ–ª–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–π –∑–∞–ø—Ä–æ—Å –∫ **OpenAI / vLLM API**.
3.  –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ **STDOUT** (–¥–ª—è —Å–±–æ—Ä–∞ –≤ ELK/Grafana) –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä—É.

**–°—Ö–µ–º–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**

```text
[ File Management Service ]  -- (JSON Request) -->  [ ML Scorer Service ]
                                                           |
                                                           +-- (1) Baseline Check (Local)
                                                           |
                                                           +-- (2) API Call --> [ OpenAI / LLM Provider ]
                                                           |
                                                           +-- (3) Logs --> [ ELK Stack ]
```

*   **–í—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ:** JSON —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤–∞–∫–∞–Ω—Å–∏–∏ –∏ —Å–ø–∏—Å–∫–æ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ (–ø–æ–ª—è –∏–∑ Excel + —Ç–µ–∫—Å—Ç —Ä–µ–∑—é–º–µ).
*   **–ò—Å—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ:** –°–ø–∏—Å–æ–∫ ID –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤, –∏—Ö Score (0.0 - 1.0) –∏ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ (–¥–ª—è LLM —Ä–µ–∂–∏–º–∞).

***


# 3. API Reference

### 3.1 Health Check
**GET** `/health`
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–∞ –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–µ–π.
```json
{
  "status": "healthy",
  "baseline_model_trained": true,
  "llm_provider": "gpt-3.5-turbo"
}
```

### 3.2 Baseline Scoring (Fast)
**POST** `/score_candidates`
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–µ–≥–∫–æ–≤–µ—Å–Ω—É—é –º–æ–¥–µ–ª—å –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è.
*   **Input:** `ScoringRequest` (—Å–º. —Å—Ö–µ–º—ã)
*   **Output:** `total_score` (–±–µ–∑ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è)

### 3.3 LLM Scoring (Deep)
**POST** `/score_candidates_llm`
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç LLM –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –æ—Ü–µ–Ω–∫–∏.
*   **Output:** `total_score` + `reason` (–ø–æ—á–µ–º—É –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ —Ç–∞–∫–∞—è –æ—Ü–µ–Ω–∫–∞).

***

# 4. –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (Development)

–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π **Poetry**.

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
*   Python 3.10+
*   Poetry

### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
1.  **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞:**
    ```bash
    git clone <repo_url>
    cd ml_service
    poetry install
    ```

2.  **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
    –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –∏–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
    ```bash
    export LLM_API_KEY="sk-..."  # –í–∞—à –∫–ª—é—á OpenAI (–∏–ª–∏ –∑–∞–≥–ª—É—à–∫–∞)
    ```

3.  **–ó–∞–ø—É—Å–∫:**
    ```bash
    poetry run uvicorn main:app --reload --host 0.0.0.0 --port 8000
    ```

4.  **–ü—Ä–æ–≤–µ—Ä–∫–∞:**
    –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:8000/docs` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Swagger UI.

***

# 5. –°–±–æ—Ä–∫–∞ –∏ –î–µ–ø–ª–æ–π (Docker)

–ü—Ä–æ–µ–∫—Ç —É–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç—Å—è –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–µ–ø–ª–æ—è –≤ Kubernetes/Cloud.

### Dockerfile
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `Dockerfile` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```dockerfile
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–µ–≥–∫–∏–π –æ–±—Ä–∞–∑ Python
FROM python:3.11-slim

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY pyproject.toml poetry.lock ./

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Poetry –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è venv –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
RUN pip install poetry && \
    poetry config virtualenvs.create false && \
    poetry install --no-interaction --no-ansi --no-dev

# –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
COPY . .

# –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç
EXPOSE 8000

# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

1.  **Build:**
    ```bash
    docker build -t candidate-scorer:v1 .
    ```

2.  **Run:**
    ```bash
    docker run -d \
      -p 8000:8000 \
      -e LLM_API_KEY="sk-proj-..." \
      --name scorer \
      candidate-scorer:v1
    ```

### –î–µ–ø–ª–æ–π –≤ Kubernetes (–ü—Ä–∏–º–µ—Ä –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞)

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ml-scorer
spec:
  replicas: 2
  selector:
    matchLabels:
      app: ml-scorer
  template:
    metadata:
      labels:
        app: ml-scorer
    spec:
      containers:
      - name: ml-scorer
        image: candidate-scorer:v1
        ports:
        - containerPort: 8000
        env:
        - name: LLM_API_KEY
          valueFrom:
            secretKeyRef:
              name: llm-secrets
              key: api-key
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
```
